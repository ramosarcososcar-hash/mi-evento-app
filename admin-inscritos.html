<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Lista de Inscritos por Evento</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
    .evento-seccion { background: white; margin-bottom: 30px; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { text-align: left; padding: 12px; border-bottom: 1px solid #ddd; }
    th { background-color: #f8f9fa; color: #333; }
    .sin-inscritos { color: #888; font-style: italic; }
  </style>
</head>
<body>

  <h1>üìä Panel de Control: Inscripciones</h1>
  <div id="lista-inscritos">Cargando datos...</div>

  <script>
    const SUPABASE_URL = "https://hguedfbzspebcyxibers.supabase.co";
    const SUPABASE_KEY = "TU_ANON_KEY"; 
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function obtenerDatos() {
      const container = document.getElementById('lista-inscritos');
      
      // 1. Traemos los eventos y sus inscritos relacionados
      const { data: eventos, error } = await supabase
        .from('eventos')
        .select(`
          id,
          titulo,
          fecha,
          inscritos (
            nombre,
            apellido1
          )
        `);

      if (error) {
        container.innerHTML = "Error: " + error.message;
        return;
      }

      container.innerHTML = "";

      eventos.forEach(evento => {
        const div = document.createElement('div');
        div.className = 'evento-seccion';
        
        let tablaHtml = `
          <h3>${evento.titulo} (${new Date(evento.fecha).toLocaleDateString()})</h3>
          <p>Total apuntados: ${evento.inscritos.length}</p>
        `;

        if (evento.inscritos.length === 0) {
          tablaHtml += `<p class="sin-inscritos">No hay nadie apuntado todav√≠a.</p>`;
        } else {
          tablaHtml += `
            <table>
              <thead>
                <tr><th>Nombre</th><th>Primer Apellido</th></tr>
              </thead>
              <tbody>
                ${evento.inscritos.map(i => `<tr><td>${i.nombre}</td><td>${i.apellido1}</td></tr>`).join('')}
              </tbody>
            </table>
          `;
        }

        div.innerHTML = tablaHtml;
        container.appendChild(div);
      });
    }

    obtenerDatos();
  </script>
</body>
<nav class="navbar">
  <div class="nav-container">
    <a href="index.html" class="nav-link nav-brand">üöÄ EventosApp</a>
    <div class="nav-menu">
      <a href="index.html" class="nav-link">üè† Inicio</a>
      <a href="crear-evento.html" class="nav-link">‚ûï Crear</a>
      <a href="admin-inscritos.html" class="nav-link">üìä Inscritos</a>
    </div>
  </div>
</nav>

<style>
  /* Reset de margen para que la barra pegue arriba */
  body { margin: 0; padding-top: 80px; } 

  .navbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1000;
    background: rgba(26, 26, 26, 0.8); /* Fondo oscuro con transparencia */
    backdrop-filter: blur(10px); /* Efecto de desenfoque moderno */
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
  }

  .nav-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 25px;
  }

  .nav-brand {
    font-size: 1.5rem;
    color: #24b47e !important;
    letter-spacing: -1px;
  }

  .nav-menu {
    display: flex;
    gap: 20px;
  }

  .nav-link {
    color: white;
    text-decoration: none;
    font-weight: 500;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    padding: 8px 12px;
    border-radius: 8px;
  }

  .nav-link:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #24b47e;
  }

  /* Responsive para m√≥viles */
  @media (max-width: 600px) {
    .nav-container { flex-direction: column; gap: 10px; }
    body { padding-top: 120px; }
  }
</style>
</html>